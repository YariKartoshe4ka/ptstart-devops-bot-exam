version: "3"

services:
  bot:
    depends_on:
      - db-main
      - db-repl

    build: bot
    env_file: .env

  db-main:
    build: db
    env_file: .env
    environment:
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_HOST_AUTH_METHOD: |
        scram-sha-256
        host replication all all scram-sha-256

    restart: on-failure:5

  db-repl:
    depends_on:
      - db-main

    build: db_repl
    env_file: .env
    environment:
      POSTGRES_PASSWORD: ${DB_REPL_PASSWORD}

    restart: on-failure:5
